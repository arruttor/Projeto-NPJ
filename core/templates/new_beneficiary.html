{% extends "base.html" %}
{% load static %}

{% block content %}
<h2>Cadastrar Beneficiário</h2>

<form action="" method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {% for field in new_beneficiary_form %}
        <div class="form-group">
            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
            {{ field }}
            {% if field.errors %}
                <div class="text-danger">{{ field.errors }}</div>
            {% endif %}
        </div>
    {% endfor %}

    <button type="submit" class="btn btn-primary">Cadastrar</button>
</form>

<script>
    document.getElementById('cep').addEventListener('blur', function () {
        const cep = this.value.replace(/\D/g, '');
    
        if (cep.length !== 8) {
            alert('CEP inválido!');
            return;
        }
    
        fetch(`https://viacep.com.br/ws/${cep}/json/`)
            .then(response => response.json())
            .then(data => {
                if (data.erro) {
                    alert('CEP não encontrado!');
                } else {
                    document.getElementById('street').value = data.logradouro || '';
                    document.getElementById('address').value = data.bairro || '';
                }
            })
            .catch(error => {
                console.error('Erro ao buscar o CEP:', error);
            });
    });
    </script>


{% endblock %}
